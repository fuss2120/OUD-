<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <link href="https://fonts.googleapis.com/css?family=Alatsi|Righteous&display=swap" rel="stylesheet">
    <link href="http://mvrhy.x10host.com/OUD/myStyle.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="myStyle.css" />
    <meta charset="utf-8">
    <title>Database</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  </head>
  <body>
    <div class="sidebar">
      <a href="entry">Patient entry</a>
      <br>
      <a href="database">Database</a>
      <br>
      <a href="/">Logout</a>
    </div>
    <div id="aligner">

      <table id="patientTable">
        <tr class=firstRow>

          <td><b>First name</b></td>
          <td><b>Last name</b></td>
          <td><b>Phone</b></td>
          <td><b>Send message</b></td>
          <td><b>More info</b></td>

        </tr>
      </table>
    </div>

    <script type="text/javascript">
      function fillTableWithContent(results) {
        var allPatientRows = "";
        for (var i = 0; i < results.length; i++) {
          addPatientRowWithData(results[i]);
        }
      }

      function addPatientRowWithData(patientData) {
        var patientRowAsHtml = patientDataToHtmlRow(patientData);
        $("#patientTable tr:last").after(patientRowAsHtml);
      }

      function patientDataToHtmlRow(patientData) {
        var answer = "<tr>";
        answer += "<td>" + patientData['first_name'] + "</td>";
        answer += "<td>" + patientData['last_name'] + "</td>";
        answer += "<td>" + patientData['phone_number'] + "</td>";
        answer += "<td><input class=msgButton type=button value='Send message'></td>";
        answer += "<td><a href='user.html'>More info</a></td>";
        answer += "</tr>";
        return answer;
      }

      // get the database
      $.get({
        url: "/all_patient_data",
        success: function(response) {
          if (response.success)
            fillTableWithContent(response.results);
          else
            console.log(response.errorMessage);
        }
      })
    </script>

  </body>
</html>
